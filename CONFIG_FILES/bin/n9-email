#!/usr/bin/perl
use strict;
use warnings;

sub run(@);

my @accounts = qw(G L);

my $emailExec = "/opt/qtemail/bin/email.pl";

my $usage = "Usage: $0 [-q|--quiet]\n";

sub main(@){
  if(`whoami` ne "user\n"){
    print "rerunning as user\n";
    exec "udo", $0, @_;
  }
  my $quiet = shift if @_ > 0 and $_[0] =~ /^(-q|--quiet)$/;
  die $usage if @_ > 0;

  #update email
  run "$emailExec --update @accounts";

  #update billboard
  run "billboard-refresh";

  if(not $quiet){
    run $emailExec, "--print";
    print "\n";
    run $emailExec, "--summary";
    print "\n";
    run $emailExec, "--status-line";
    print "\n";
  }
}

sub run(@){
  print "@_\n";
  system @_;
}

&main(@ARGV);
